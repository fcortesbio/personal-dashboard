services:
  backend:
    build: .
    container_name: "dashboard_backend"
    restart: unless-stopped
    networks:
      # Connection to Traefik external network -- see: https://github.com/fcortesbio/traefik-gatekeeper
      - traefik_proxy
    ports:
      - "4000:4000"
    volumes:
      # ensures data persistance -- it links local ./data to /app/data in the container
      - ./data:/app/data
    env_file:
      - .env
    labels:
      # -- Traefik routing rules --
      - "traefik.enable=true"
      - "traefik.http.routers.dashboard-api.rule=Host(`dashboard`)"
      - "traefik.http.routers.dashboard-api.service=dashboard-api-service"
      - "traefik.http.routers.dashboard-api.entrypoints=web"
      - "traefik.http.services.dashboard-api-service.loadbalancer.server.port=4000"

networks:
  traefik_proxy:
    external: true
